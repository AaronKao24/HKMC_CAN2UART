#
# Copyright (c) 2018 Nordic Semiconductor
#
# SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
#

# Enable CPU tracing
CONFIG_CPU_LOAD=n
CONFIG_CPU_LOAD_LOG_INTERVAL=1000
CONFIG_CPU_LOAD_LOG_PERIODIC=n


# Virtual COM
CONFIG_USB_COMPOSITE_DEVICE=y
CONFIG_USB_DFU_CLASS=y
CONFIG_IMG_MANAGER=y

#CONFIG_BOARD_ENABLE_DCDC=y
CONFIG_BOARD_ENABLE_DCDC=n
CONFIG_BOARD_ENABLE_DCDC_HV=n

# Enable USB subsystem
CONFIG_USB_DEVICE_STACK=y
CONFIG_USB_DEVICE_HID=n
CONFIG_USB_HID_BOOT_PROTOCOL=n
CONFIG_USB_CDC_ACM=y
CONFIG_USB_DEVICE_PRODUCT="BLE_ACM"
CONFIG_UART_LINE_CTRL=y
#CONFIG_UART_INTERRUPT_DRIVEN=y
CONFIG_MCUMGR_SMP_UART=y

CONFIG_DATE_TIME=y
CONFIG_DATE_TIME_NTP=n

CONFIG_SPI_3_NRF_RX_DELAY=0
CONFIG_SPI_NRFX_RAM_BUFFER_SIZE=0

# Enable the UART driver
CONFIG_UART_ASYNC_API=y
CONFIG_NRFX_UARTE0=y
CONFIG_UART_0_ASYNC=y
CONFIG_SERIAL=y

CONFIG_GPIO=y
CONFIG_GPIO_AS_PINRESET=n

CONFIG_PWM=y
CONFIG_LED=y
CONFIG_LED_PWM=y
CONFIG_COUNTER=y
CONFIG_COUNTER_TIMER3=y

CONFIG_ADC=y

CONFIG_SPI=y
CONFIG_SPI_NRFX=y
CONFIG_NRFX_SPIM=y
CONFIG_NRFX_SPIM3=y

CONFIG_HEAP_MEM_POOL_SIZE=2048
CONFIG_NCS_SAMPLES_DEFAULTS=y
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
# for pairing accept callback
CONFIG_BT_SMP_APP_PAIRING_ACCEPT=y
#william search websize that android might get Error=133, add this for testing.
CONFIG_CLOCK_CONTROL_NRF_K32SRC_RC=y

CONFIG_BT_DEVICE_NAME="EH02_77777"

# for dynamic device name
CONFIG_BT_DEVICE_NAME_DYNAMIC=y
CONFIG_BT_DEVICE_NAME_MAX=20

CONFIG_BT_DEVICE_APPEARANCE=1152
CONFIG_BT_MAX_CONN=1
CONFIG_BT_MAX_PAIRED=32
CONFIG_BT_CTLR_CONN_RSSI=y
CONFIG_BT_CTLR_TX_PWR_DYNAMIC_CONTROL=y
# Enable the NUS service
#CONFIG_BT_NUS=y
#CONFIG_BT_NUS_SECURITY_ENABLED=y
CONFIG_BT_CENTRAL=y
CONFIG_BT_AUTO_PHY_UPDATE=n
CONFIG_BT_PRIVACY=n
CONFIG_BT_MAX_CONN=16

# Enable the BLE stack with GATT Client configuration
CONFIG_BT_SMP=y
CONFIG_BT_GATT_CLIENT=y

CONFIG_BT_BMS=y
# Enable the BLE modules from NCS
#CONFIG_BT_NUS_CLIENT=y
CONFIG_BT_SCAN=y
CONFIG_BT_SCAN_FILTER_ENABLE=y
CONFIG_BT_SCAN_UUID_CNT=1
CONFIG_BT_SCAN_SHORT_NAME_CNT=1
CONFIG_BT_GATT_DM=y
CONFIG_HEAP_MEM_POOL_SIZE=2048
CONFIG_BT_FIXED_PASSKEY=y

# Eable the BLE Mac Address & Local Name be Scaned
CONFIG_BT_SCAN_ADDRESS_CNT=1
CONFIG_BT_SCAN_SHORT_NAME_MAX_LEN=1

# Enable bonding
CONFIG_BT_SETTINGS=y
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y
CONFIG_NVS=y
CONFIG_SETTINGS=y

CONFIG_CAN=n

# Enable DK LED and Buttons library = LBS (LED Button Service)
# CONFIG_BT_LBS=y
# CONFIG_BT_LBS_POLL_BUTTON=y
# CONFIG_DK_LIBRARY=y



# Make sure printk is not printing to the UART console
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y

# Config logger
CONFIG_LOG=y
CONFIG_LOG_BACKEND_UART=n
CONFIG_LOG_BACKEND_UART_ASYNC=n
CONFIG_LOG_MODE_DEFERRED=n
CONFIG_LOG_RUNTIME_FILTERING=n
CONFIG_LOG_BUFFER_SIZE=2048
CONFIG_LOG_PRINTK=n
CONFIG_LOG_PROCESS_TRIGGER_THRESHOLD=0
CONFIG_COVERAGE=n
CONFIG_LOG_TAG_MAX_LEN=8
CONFIG_USE_SEGGER_RTT=n
CONFIG_RTT_CONSOLE=n
CONFIG_LOG_BACKEND_RTT=n
CONFIG_LOG_BACKEND_SHOW_COLOR=n
CONFIG_ASSERT=n

### MCUBOOT
# Enable mcumgr.
CONFIG_MCUMGR=y
CONFIG_MBEDTLS=y
CONFIG_MBEDTLS_BUILTIN=y
CONFIG_MBEDTLS_ENABLE_HEAP=y
CONFIG_MBEDTLS_HEAP_SIZE=10240
CONFIG_MBEDTLS_USER_CONFIG_ENABLE=y
CONFIG_MBEDTLS_USER_CONFIG_FILE="user-tls.h"
CONFIG_MBEDTLS_TLS_LIBRARY=y
CONFIG_NRF_SECURITY_ADVANCED=y

CONFIG_MBEDTLS_AES_C=y
CONFIG_MBEDTLS_CIPHER_MODE_CBC=y
# Disable unneeded crypto operations
CONFIG_MBEDTLS_CTR_DRBG_C=n
CONFIG_MBEDTLS_CIPHER_MODE_CTR=n
CONFIG_MBEDTLS_ECJPAKE_C=n
CONFIG_MBEDTLS_SHA256_C=n
CONFIG_MBEDTLS_PK_C=n
CONFIG_MBEDTLS_PK_WRITE_C=n

# Disable unneeded crypto operations
CONFIG_MBEDTLS_SHA384_C=n
CONFIG_MBEDTLS_SHA512_C=n
CONFIG_MBEDTLS_CIPHER_MODE_XTS=n
CONFIG_MBEDTLS_CHACHA20_C=n
CONFIG_MBEDTLS_POLY1305_C=n
CONFIG_MBEDTLS_CHACHAPOLY_C=n
# CONFIG_MBEDTLS_GCM_C=n
CONFIG_MBEDTLS_RSA_C=n

CONFIG_NEWLIB_LIBC=y


# Ensure an MCUboot-compatible binary is generated.
CONFIG_BOOTLOADER_MCUBOOT=y

# Enable the Bluetooth (unauthenticated) and shell mcumgr transports.
CONFIG_MCUMGR_SMP_BT=y
CONFIG_MCUMGR_SMP_BT_AUTHEN=n
CONFIG_MCUMGR_SMP_SHELL=n
# Required by the `taskstat` command.
CONFIG_THREAD_MONITOR=y

# Enable statistics and statistic names.
CONFIG_STATS=y
CONFIG_STATS_NAMES=y

# Enable most core commands.
CONFIG_NORDIC_QSPI_NOR=y

# Allow for large Bluetooth data packets.
CONFIG_BT_L2CAP_TX_MTU=252
CONFIG_BT_BUF_ACL_RX_SIZE=248
CONFIG_BT_BUF_ACL_TX_SIZE=248
CONFIG_BT_CTLR_DATA_LENGTH_MAX=240

CONFIG_DISPLAY=y
CONFIG_ST7789V=y

# Add 256 bytes to accommodate upload command (lfs_stat overflows)
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2304
#CONFIG_BT_NUS_THREAD_STACK_SIZE=8196

# Enable file system commands
CONFIG_MCUMGR_CMD_FS_MGMT=n
CONFIG_MCUMGR_CMD_SHELL_MGMT=n
CONFIG_MCUMGR_CMD_IMG_MGMT=y
CONFIG_MCUMGR_CMD_OS_MGMT=y
CONFIG_MCUMGR_CMD_STAT_MGMT=y


# use watch dog
CONFIG_WATCHDOG=y
CONFIG_WDT_LOG_LEVEL_DBG=n
CONFIG_WDT_DISABLE_AT_BOOT=y

CONFIG_TASK_WDT=y
CONFIG_TASK_WDT_MIN_TIMEOUT=1000

CONFIG_THREAD_NAME=y


#CONFIG_CLOCK_CONTROL_NRF_K32SRC_RC=n
#CONFIG_CLOCK_CONTROL_NRF_K32SRC_XTAL=y
#CONFIG_CLOCK_CONTROL_NRF_K32SRC_RC_CALIBRATION=y
#CONFIG_CLOCK_CONTROL_NRF_CALIBRATION_LF_ALWAYS_ON=y
#CONFIG_CLOCK_CONTROL_NRF_CALIBRATION_MAX_SKIP=1
#CONFIG_CLOCK_CONTROL_NRF_CALIBRATION_PERIOD=4000
#CONFIG_CLOCK_CONTROL_NRF_CALIBRATION_TEMP_DIFF=2

#use temp
CONFIG_NRFX_TEMP=n